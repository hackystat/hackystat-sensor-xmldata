<project name="jar" default="jar">
  <description>
  Provides the target for building Java5 and Java6 jar files of the SensorShell.
  </description>

  <import file="build.xml"/>
  <property name="tmp.dir" location="${basedir}/tmp" />
 
  <target name="jar" depends="compile" 
     description="Create sensorshell.jar.">

     <mkdir dir="${tmp.dir}" />
     <copy todir="${tmp.dir}">
       <fileset dir="${basedir}/build/classes/">
          <include name="org/hackystat/sensorshell/**"/>
       </fileset>
     </copy>
    
     <unjar src="${env.HACKYSTAT_UTILITIES_HOME}/hackystatlogger.lib.jar" dest="${tmp.dir}"/>
     <unjar src="${env.HACKYSTAT_UTILITIES_HOME}/stacktrace.lib.jar" dest="${tmp.dir}"/>
     <unjar src="${env.HACKYSTAT_SENSORBASE_HOME}/sensorbase.lib.jar" dest="${tmp.dir}"/>
     <unjar src="${env.RESTLET_HOME}/lib/org.restlet.jar" dest="${tmp.dir}"/>
     <unjar src="${env.RESTLET_HOME}/lib/com.noelios.restlet.jar" dest="${tmp.dir}"/>
     <unjar src="${env.RESTLET_HOME}/lib/com.noelios.restlet.ext.net.jar" dest="${tmp.dir}"/>
   
     <jar destfile="${basedir}/sensorshell.java6.jar" basedir="${tmp.dir}">
       <manifest>
         <attribute name="Main-Class" value="org.hackystat.sensorshell.SensorShell"/>
         <attribute name="Implementation-Title" value="HackystatLogger"/>
         <attribute name="Implementation-Version" value="${version}"/>
         <attribute name="Implementation-Vendor" value="Collaborative Software Development Laboratory, University of Hawaii"/>
       </manifest>
     </jar>

     <!-- Now build sensorshell.java5.jar, which adds in JAXB --> 
     <unjar src="${env.JAXB_HOME}/lib/activation.jar" dest="${tmp.dir}"/>
     <unjar src="${env.JAXB_HOME}/lib/jaxb-api.jar" dest="${tmp.dir}"/>
     <unjar src="${env.JAXB_HOME}/lib/jaxb-impl.jar" dest="${tmp.dir}"/>
     <unjar src="${env.JAXB_HOME}/lib/jsr173_1.0_api.jar" dest="${tmp.dir}"/>
       
     <!-- The following magic deletion allows activation.jar to be packaged without creating runtime errors. --> 
     <!-- See http://jira.codehaus.org/browse/MASSEMBLY-64 for details. --> 
     <delete>
       <fileset dir="${tmp.dir}/META-INF" includes="*.RSA,*.DSA,*.SF,*.rsa,*.dsa,*.sf"/>
     </delete>
    
     <jar destfile="${basedir}/sensorshell.java5.jar" basedir="${tmp.dir}">
        <manifest>
          <attribute name="Main-Class" value="org.hackystat.sensorshell.SensorShell"/>
          <attribute name="Implementation-Title" value="HackystatLogger"/>
          <attribute name="Implementation-Version" value="${version}"/>
          <attribute name="Implementation-Vendor" value="Collaborative Software Development Laboratory, University of Hawaii"/>
        </manifest>
      </jar>   
     <delete dir="${tmp.dir}" />
   </target>  
</project>

